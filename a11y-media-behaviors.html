<link rel="import" href="../responsive-utility/responsive-utility.html">
<!--
`a11y-media-behaviors`
A set of behaviors for a11y-media components.
@microcopy - the mental model for this element
 - 
 - 
-->

<script>
  window.a11yMediaBehaviors = window.a11yMediaBehaviors || {};
  window.a11yMediaBehaviors.PlayerBehaviors = {
    properties: {
      /** 
        * Accent color on controls. Default is blue.
        */ 
      accentColor: {
        type: String,
        value: null,
        reflectToAttribute: true,
      },
      /** 
        * Allow this media to play concurrently with other a11y-media-players? 
        * Default is to pause this a11y-media-player when other a11y-media-player starts playing.
        */ 
      allowConcurrent: {
        type: Boolean,
        value: false,
        reflectToAttribute: true,
      },
      /** 
        * Is this an audio file?
        */ 
      audioOnly: {
        type: Boolean,
        value: false,
        reflectToAttribute: true,
      },
      /** 
        * autoplay is an option, 
        * but generally not recommended for a11y
        */ 
      autoplay: {
        type: Boolean,
        value: false,
      },
      /**
        * show closed captions
        */
      cc: {
        type: Boolean,
        value: false,
      },
      /** 
        * disable fullscreen option 
        */
      dark: {
        type: Boolean,
        value: false,
        reflectToAttribute: true
      },
      /** 
        * disable fullscreen option 
        */
      disableFullscreen: {
        type: Boolean,
        value: false,
      },
      /** 
        * Is fullscreen mode?
        */
      fullscreen: {
        type: Boolean,
        value: false,
      },
      /** 
        * Does the player have tracks?
        */
      hasCaptions: {
        type: Boolean,
        value: false,
      },
      /** 
        * Does the player have an interactive transcript?
        */
      hasTranscript: {
        type: Boolean,
        value: false,
      },
      /** 
        * The width of the media player. 
        */
      height: {
        type: String,
        value: 'unset'
      },
      /** 
        * Hide elapsed time?
        */
      hideElapsedTime: {
        type: Boolean,
        value: false,
      },
      /** 
        * Hide the transcript?
        */
      hideTranscript: {
        type: Boolean,
        value: false,
        reflectToAttribute: true,
      },
      /**
        * Language
        */
      lang: {
        type: String,
        value: 'en',
        reflectToAttribute: true,
      },
      /** 
        * Loop the video?
        */
      loop: {
        type: Boolean,
        value: false,
      },
      /**
        * optional title of media (shows when printed)
        */
      mediaTitle: {
        type: String,
        value: '',
        reflectToAttribute: true,
      },
      /**
        * Is the size mobile?
        */
      smallPlayer: {
        type: Boolean,
        computed: '_testAttribute(responsiveSize,"xs")',
        notify: true,
        reflectToAttribute: true
      },
      /** 
        * Is audio muted?
        */
      muted: {
        type: Boolean,
        value: false,
      },
      /**
        * Is it an audio player with no thumbnail?
        */
      noHeight: {
        type: Boolean,
        computed: '_getNoHeight(audioOnly,thumbnailSrc)',
        reflectToAttribute: true
      },
      /**
        * Playback rate where 1 is normal speed, 0.5 is half-speed, and 2 is double speed
        */
      playbackRate: {
        type: Number,
        value: 1
      },
      /**
        * Is media playing?
        */
      playing: {
        type: Boolean,
        value: false
      },
      /**
        * Size of the a11y media element for responsive styling
        */
      responsiveSize: {
        type: String,
        notify: true,
        reflectToAttribute: true
      },
      /**
        * show the FullscreenButton?
        */
      fullscreenButton: {
        type: Boolean,
        computed: '_getFullscreenButton(disableFullscreen)',
        notify: true
      },
      /** 
        * Is the video currently sticky, i.e. it is fixed to the corner when playing but scrolled off screen? 
        */
      sticky: {
        type: Boolean,
        value: false,
        reflectToAttribute: true
      },
      /** 
        * When playing but scrolled off screen, to which corner does it stick: 
        * top-left, top-right, bottom-left, bottom-right, or none? 
        * Default is "top-right". "None" disables stickiness.
        */
      stickyCorner: {
        type: String,
        value: 'top-right',
        reflectToAttribute: true
      },
      /**
        * Source of optional thumbnail image
        */
      thumbnailSrc: {
        type: String,
        value: null,
        reflectToAttribute: true
      },
      /** 
        * array of tracks and cues
        */
      tracks: {
        type: Array,
        value: null
      },
      /** 
        * Range is 0 to 100. Default should not be loud enough to overpower screen readers. 
        */
      volume: {
        type: Number,
        value: 70,
      },
      /** 
        * The width of the media player. 
        */
      width: {
        type: String,
        value: 'unset'
      }
    },
    /**
      * returns true if an attribute is set to a value
      */ 
    _getNoHeight: function(audioOnly,thumbnailSrc){
      return audioOnly && (thumbnailSrc === null || thumbnailSrc === undefined);
    },
    /**
      * returns true if an attribute is set to a value
      */ 
    _getFullscreenButton: function(disableFullscreen){
      if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || disableFullscreen) {
        return false;
      } else {
        return true;
      }
    },
    /**
      * returns true if an attribute is set to a value
      */ 
    _testAttribute: function(attr,val){
      return attr === val;
    }
  };
  window.a11yMediaBehaviors.TranscriptBehaviors = {
    properties: {
      /** 
        * Accent color on controls. Default is blue.
        */ 
      accentColor: {
        type: String,
        value: null,
        reflectToAttribute: true,
      },
      /** 
        * disable interactive mode that makes the transcript clickable 
        */
      disableInteractive: {
        type: Boolean,
        value: false,
      },
      /** 
        * disable transcript search feature 
        */
      disableSearch: {
        type: Boolean,
        value: false,
      },
      /** 
        * disable autoscrolling as transcript plays 
        */
      disableScroll: {
        type: Boolean,
        value: false,
      },
      /** 
        * disable transcript print button
        */
      disablePrintButton: {
        type: Boolean,
        value: false,
      },
      /**
        * show cue's start and end time 
        */
      hideTimestamps: {
        type: Boolean,
        value: false,
      },
      /**
        * show cue's start and end time 
        */
      media: {
        type: Object,
        value: {},
      },
      /**
        * the search tool for the transcript
        */
      search: {
        type: Object,
        value: null,
      },
      /**
        * selected transcript track id
        */
      selectedTranscript: {
        type: String,
        value: '0',
      }
    }
  };
  window.a11yMediaBehaviors.GeneralFunctions = {
    properties: {
      /**
        * custom microcopy that can override defaults
        */
      customMicrocopy: {
        type: Object,
        value: {}
      },
      /**
        * microcopy
        */
      microcopy: {
        type: Object,
        computed: '_getMicrocopy(customMicrocopy)'
      }
    },
    /**
      * calls responsive-utility to get parent's responsive size
      */ 
    _addResponsiveUtility: function(data){
      let root = this, data2 = data !== undefined ? data : {
        "element": root,
        "attribute": "responsive-size",
        "relativeToParent": true,
      };
      Polymer.ResponsiveUtility.requestAvailability();
      root.fire('responsive-element',data2);
    },
    /**
      * customizes the microcopy of any overriden defaults.
      * Defaults are as follows: 
      * {
      *   "lang": "en",
      *   "captions": {
      *     "label": "closed captions",
      *     "icon": "av:closed caption",
      *   },
      *   "backward": {
      *     "label": "backward",
      *     "icon": "av:fast-rewind",
      *   },
      *   "forward": {
      *     "label": "forward",
      *     "icon": "av:fast-forward",
      *   },
      *   "fullscreen": {
      *     "label": "fullscreen",
      *     "icon": "fullscreen",
      *   },
      *   "mute": {
      *     "label": "mute",
      *     "icon": "av:volume-up",
      *   },
      *   "pause": {
      *     "label": "pause",
      *     "icon": "av:pause",
      *   },
      *   "play": {
      *     "label": "play",
      *     "icon": "av:play-arrow",
      *   },
      *   "print": {
      *     "label": "print",
      *     "icon": "print",
      *   },
      *   "restart": {
      *     "label": "restart",
      *     "icon": "av:replay",
      *   },
      *   "settings": {
      *     "label": "settings",
      *     "icon": "settings",
      *     "items": {
      *       "captions": "Captions",
      *       "captionsOff": "Off",
      *       "loop": "Loop",
      *       "speed": "Speed %",
      *       "transcript": "Transcript"
      *     }
      *   },
      *   "skipTranscript": "Skip the transcript.", //off-screen link for screenreaders to skip the transcript
      *   "transcript": {
      *     "label": "transcript",
      *     "icon": "description",
      *   },
      *   "unmute": {
      *     "label": "unmute",
      *     "icon": "av:volume-off",
      *   },
      *   "volume": {
      *     "label": "volume",
      *   },
      * },
      */ 
    _getMicrocopy: function(customMicrocopy){
      let defaults = {
        "lang": "en",
        "audio": "audio",
        "autoScroll": {
          "label": "auto-scrolling",
          "icon": "swap-vert"
        },
        "captions": {
          "label": "closed captions",
          "icon": "av:closed caption"
        },
        "backward": {
          "label": "backward",
          "icon": "av:fast-rewind"
        },
        "forward": {
          "label": "forward",
          "icon": "av:fast-forward"
        },
        "fullscreen": {
          "label": "fullscreen",
          "icon": "fullscreen"
        },
        "mute": {
          "label": "mute",
          "icon": "av:volume-up"
        },
        "pause": {
          "label": "pause",
          "icon": "av:pause",
        },
        "play": {
          "label": "play",
          "icon": "av:play-arrow"
        },
        "print": {
          "label": "print",
          "icon": "print"
        },
        "restart": {
          "label": "restart",
          "icon": "av:replay"
        },
        "searchTranscript": "search transcript",
        "settings": {
          "label": "settings",
          "icon": "settings",
          "items": {
            "captions": "Captions",
            "captionsOff": "Off",
            "loop": "Loop",
            "speed": "Speed %",
            "transcript": "Transcript"
          }
        },
        "skipTranscript": "Skip the transcript.",
        "transcript": {
          "label": "transcript",
          "icon": "description"
        },
        "unmute": {
          "label": "unmute",
          "icon": "av:volume-off"
        },
        "video": "video",
        "volume": "volume"
      }, setLocal = function(defaults,customs){
        if(customs !== null && customs !== undefined) {
          for (var key in defaults){
            if(customs[key] !== null & customs[key] !== undefined) {
              if(typeof(customs[key]) == Object){
                defaults[key] = setLocal(defaults[key],customs[key]);
              } else {
                defaults[key] = customs[key];
              }
            }
          }
        }
        return defaults;
      };
      return setLocal(defaults,customMicrocopy);
    }
  };
</script>

